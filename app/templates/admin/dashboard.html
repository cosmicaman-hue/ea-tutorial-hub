{% extends "base.html" %}

{% block title %}Admin Dashboard - EA Tutorial Hub{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <i class="fas fa-users fa-2x float-end opacity-50"></i>
                    <h5 class="card-title">Total Users</h5>
                    <h2>{{ stats.total_users }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <i class="fas fa-user-graduate fa-2x float-end opacity-50"></i>
                    <h5 class="card-title">Students</h5>
                    <h2>{{ stats.total_students }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <i class="fas fa-chalkboard-user fa-2x float-end opacity-50"></i>
                    <h5 class="card-title">Teachers</h5>
                    <h2>{{ stats.total_teachers }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <i class="fas fa-exclamation-circle fa-2x float-end opacity-50"></i>
                    <h5 class="card-title">Pending Notes</h5>
                    <h2>{{ stats.pending_notes }}</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="fas fa-book"></i> Notes Management</h5>
                </div>
                <div class="card-body">
                    <p>Total Notes: <strong>{{ stats.total_notes }}</strong></p>
                    <p>Pending Approval: <strong>{{ stats.pending_notes }}</strong></p>
                    <a href="{{ url_for('admin.pending_notes') }}" class="btn btn-warning">
                        <i class="fas fa-check-circle"></i> Review Pending Notes
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="fas fa-question-circle"></i> Quiz Management</h5>
                </div>
                <div class="card-body">
                    <p>Total Quizzes: <strong>{{ stats.total_quizzes }}</strong></p>
                    <p>Create quizzes with AI assistance or manage existing quizzes.</p>
                    <a href="{{ url_for('quiz_ai.create_ai_quiz') }}" class="btn btn-info">
                        <i class="fas fa-magic"></i> Create Quiz with AI
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: AI Features and Profile Viewer -->
    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0"><i class="fas fa-robot"></i> AI-Powered Features</h5>
                </div>
                <div class="card-body">
                    <p>Generate quizzes automatically from documents using AI:</p>
                    <ul>
                        <li>OpenAI GPT-3.5</li>
                        <li>Google Gemini</li>
                        <li>Anthropic Claude</li>
                    </ul>
                    <a href="{{ url_for('quiz_ai.create_ai_quiz') }}" class="btn btn-primary">
                        <i class="fas fa-magic"></i> Create Quiz with AI
                    </a>
                    <a href="{{ url_for('quiz_ai.ai_quiz_list') }}" class="btn btn-outline-primary">
                        <i class="fas fa-list"></i> View AI Quizzes
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0"><i class="fas fa-users"></i> Student Profiles</h5>
                </div>
                <div class="card-body">
                    <p>View and manage all student profiles dynamically:</p>
                    <ul>
                        <li>Search and filter students</li>
                        <li>View detailed profiles</li>
                        <li>Track activity logs</li>
                        <li>Export CSV reports</li>
                    </ul>
                    <a href="{{ url_for('profile_viewer.view_all_profiles') }}" class="btn btn-success">
                        <i class="fas fa-eye"></i> View All Profiles
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="fas fa-cog"></i> Admin Controls</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="{{ url_for('admin.manage_users') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-users-cog"></i> Manage Users
                        </a>
                        <a href="{{ url_for('admin.create_user') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-user-plus"></i> Create User Account
                        </a>
                        <a href="{{ url_for('admin.pending_notes') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-file-upload"></i> Approve Notes
                        </a>
                        <a href="{{ url_for('admin.activity_log') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-history"></i> Activity Log
                        </a>
                        <a href="{{ url_for('admin.settings') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-sliders-h"></i> System Settings
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if recent_activities %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="fas fa-clock"></i> Recent Activities</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Time</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for activity in recent_activities[:5] %}
                            <tr>
                                <td><small>{{ activity.timestamp.strftime('%H:%M:%S') }}</small></td>
                                <td>
                                    {% if activity.user_rel %}
                                        <small><strong>{{ activity.user_rel.login_id }}</strong></small>
                                    {% else %}
                                        <small class="text-muted">System</small>
                                    {% endif %}
                                </td>
                                <td><small>{{ activity.action }}</small></td>
                                <td><small>{{ activity.ip_address }}</small></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="card-footer">
                    <a href="{{ url_for('admin.activity_log') }}" class="btn btn-sm btn-outline-primary">
                        View Full Activity Log
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
